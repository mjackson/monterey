/*!
 * monterey.js - https://github.com/mjijackson/monterey.js
 * Copyright 2012 Michael Jackson
 */(function(){function r(e,t,n){typeof n=="function"&&r(n,"__monterey_name__",t),Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0,configurable:!0})}function i(e,t){for(var n in t)r(e,n,t[n])}function s(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:n})}function o(e){return function t(){var n=t.caller;return e[n.__monterey_name__||n.name]}}function u(e){return function(){Object[e].apply(Object,[this].concat(t.call(arguments,0)))}}var e=Array.isArray,t=Array.prototype.slice,n=1,a=u("on"),f=u("off"),l=u("trigger");i(Object,{merge:function(e){var n=t.call(arguments,1),r;return n.forEach(function(t){for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}),e},copy:function(e){return Object.merge({},e)},guid:function(e){return e.hasOwnProperty("__monterey_guid__")||r(e,"__monterey_guid__",String(Date.now()+"_"+n++)),e.__monterey_guid__},events:function(e){return e.hasOwnProperty("__monterey_events__")||r(e,"__monterey_events__",{}),e.__monterey_events__},on:function(t,n,r){if(typeof r!="function")throw new Error("Event handler must be a function");var i=Object.events(t);i.newListener&&Object.trigger(t,"newListener",n,r),i[n]?e(i[n])?i[n].push(r):i[n]=[i[n],r]:i[n]=r},off:function(t,n,r){var i=Object.events(t);if(!r){delete i[n];return}var s=i[n],o=Object.guid(r);if(!s||!o)return;if(e(s)){var u=[];for(var a=0;a<s.length;++a)s[a].__monterey_guid__!==o&&u.push(s[a]);u.length?i[n]=u.length===1?u[0]:u:delete i[n]}else s.__monterey_guid__===o&&delete i[n]},trigger:function(n,r){var i=Object.events(n),s=i[r];if(!s)return;var o={type:r,time:new Date,source:n},u=[o].concat(t.call(arguments,2));if(e(s)){for(var a=0,f=s.length;a<f;++a)if(s[a].apply(n,u)===!1)break}else s.apply(n,u)},addEvents:function(e){return i(e,{on:a,off:f,trigger:l}),e}}),i(Function.prototype,{inherit:function(e){if(typeof e!="function")throw new Error("Parent must be a function");i(this,e),this.prototype=Object.create(e.prototype),r(this.prototype,"constructor",this),s(this.prototype,"super",o(e.prototype))},extend:function(e){var t=this;typeof e=="function"&&(e=e(t.prototype));var n;return e&&e.hasOwnProperty("constructor")?n=e.constructor:n=function(){t.apply(this,arguments)},n.inherit(t),e&&i(n.prototype,e),n},isParentOf:function(e){return this.prototype===Object.getPrototypeOf(e.prototype)},isChildOf:function(e){return e.isParentOf(this)},isAncestorOf:function(e){return this.prototype.isPrototypeOf(e.prototype)},isDescendantOf:function(e){return e.isAncestorOf(this)}}),s(Function.prototype,"parent",function(){var e=Object.getPrototypeOf(this.prototype);return e&&e.constructor}),s(Function.prototype,"ancestors",function(){var e=[],t=this;do e.push(t);while(t=t.parent);return e})})();